<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory Dashboard</title>
  <link rel="stylesheet" href="dashboard.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

  <div class="dashboard">

    <!-- TOP SECTION -->
    <div class="top-section">
      <div class="left-side">
        <!-- SUMMARY CARDS -->
        <div class="summary-section">
          <div class="summary-card total">
            <div class="summary-info">
              <p>Total Products</p>
              <h2>1,247</h2>
              <small>+12% from last month</small>
            </div>
            <div class="summary-icon"><img src="../images/inventory.svg" alt="Total"></div>
          </div>

          <div class="summary-card low-stock">
            <div class="summary-info">
              <p>Low Stock Items</p>
              <h2>142</h2>
              <small>‚ö†Ô∏è Needs attention</small>
            </div>
            <div class="summary-icon"><img src="../images/warning.svg" alt="Low Stock"></div>
          </div>

          <div class="summary-card sales">
            <div class="summary-info">
              <p>Today's Sales</p>
              <h2>‚Ç±1,247</h2>
              <small>+25% from yesterday</small>
            </div>
            <div class="summary-icon"><img src="../images/money.svg" alt="Sales"></div>
          </div>

          <div class="summary-card active-alerts">
            <div class="summary-info">
              <p>Active Alerts</p>
              <h2>12</h2>
              <small>Pending review</small>
            </div>
            <div class="summary-icon"><img src="../images/bell.svg" alt="Alerts"></div>
          </div>
        </div>

        <!-- CHART + TOP PRODUCTS SIDE BY SIDE -->
        <div class="chart-products-row">
          <div class="chart-card">
            <h3>Recent Alerts</h3>
            <div class="chart-placeholder">
              <i class="fa-solid fa-chart-line"></i>
              <p>Alerts Overview Chart</p>
            </div>
          </div>

          <div class="top-products">
            <h3>Top Selling Products</h3>
            <div class="product-item">
              <div class="product-left">
                <div class="product-icon"></div>
                <span>Product A</span>
              </div>
              <span>100 sold</span>
            </div>
            <div class="product-item">
              <div class="product-left">
                <div class="product-icon"></div>
                <span>Product B</span>
              </div>
              <span>95 sold</span>
            </div>
            <div class="product-item">
              <div class="product-left">
                <div class="product-icon"></div>
                <span>Product C</span>
              </div>
              <span>89 sold</span>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div class="right-panel">
        <h3>Recent Alerts</h3>
        <div class="alert-item">
          <div class="dot blue"></div>
          <div>
            <p><strong>Low Stock Alert!</strong></p>
            <small>Product A is running low (5 units left)</small><br>
            <small>2 hours ago</small>
          </div>
        </div>

        <div class="alert-item">
          <div class="dot green"></div>
          <div>
            <p><strong>Restock Complete</strong></p>
            <small>Product B restocked with 10 units</small><br>
            <small>4 hours ago</small>
          </div>
        </div>

        <h4 class="quick-title">Quick Actions</h4>
        <div class="button-row">
  <button class="btn add" id="add-product">
    <img src="../images/add.svg" class="btn-icon"> Add New Product
  </button>
  <button class="btn add" id="add-user">
    <img src="../images/adduser.svg" class="btn-icon"> Add New User
  </button>
  <button class="btn add" id="export-data">
    <img src="../images/export.svg" class="btn-icon"> Export Report
  </button>
</div>

        <button class="btn settings">
          <img src="../images/settings.svg" alt="Settings" class="btn-icon">
          Alert Settings
        </button>

      </div>
    </div>

    <!-- RECENT ACTIVITY -->
    <div class="activity-section">
      <h3>Recent Activity</h3>
      <div class="activity-item">
        <div class="dot blue"></div>
        <div>
          <p><strong>Sinigang Mix</strong> updated inventory thresholds</p>
          <small>2 hours ago</small>
        </div>
      </div>
      <div class="activity-item">
        <div class="dot blue"></div>
        <div>
          <p><strong>Adobong Kambing</strong> acknowledged low stock alert</p>
          <small>4 hours ago</small>
        </div>
      </div>
    </div>

  </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  // üß© Get user object from localStorage (used by sidebar)
  const userData = localStorage.getItem("user");
  let role = "";

  if (userData) {
    try {
      const user = JSON.parse(userData);
      role = (user.role || "").trim().toLowerCase();
    } catch (e) {
      console.error("‚ùå Error parsing user data:", e);
    }
  }

  console.log("üéØ Detected role:", role);

  // üéØ Get dashboard buttons
  const addUserBtn = document.getElementById("add-user");
  const addProductBtn = document.getElementById("add-product");
  const exportDataBtn = document.getElementById("export-data");
  const alertSettingsBtn = document.querySelector(".btn.settings");

  // üîí Disable button completely and show üö´ cursor
  const disableButton = (btn, message) => {
    if (!btn) return;
    btn.classList.add("locked");
    btn.title = message;
    btn.disabled = true;
    btn.style.opacity = "0.6";
    btn.style.cursor = "not-allowed";
  };

  // üß≠ Helper: open page and highlight sidebar item
  const doc = parent?.document || document;
  const pageChanger = parent?.changePage || window.changePage;

  function openPage(title, subtitle, file) {
    if (pageChanger) {
      pageChanger(title, subtitle, null, file);
      const sidebarItems = doc.querySelectorAll("li[onclick*='changePage']");
      sidebarItems.forEach((li) => {
        const match = li.getAttribute("onclick").includes(file);
        li.classList.toggle("active", match);
      });
    } else {
      console.warn("‚ö†Ô∏è changePage() not found");
    }
  }

  // ===============================
  // üß∑ ROLE PERMISSIONS LOGIC
  // ===============================
  if (role.includes("admin")) {
    console.log("‚úÖ Admin detected: Export allowed");

    if (exportDataBtn) {
      exportDataBtn.addEventListener("click", () =>
        openPage("Export Report", "Export and download data", "../Contents/export-report.html")
      );
    }
  } else if (role.includes("manager")) {
    console.log("‚ö†Ô∏è Manager detected: Export disabled");
    disableButton(exportDataBtn, "Managers cannot export reports");
  } else {
    console.log("üë§ Other role detected: Export disabled");
    disableButton(exportDataBtn, "You do not have permission to export data");
  }

  // ===============================
  // üåç COMMON BUTTONS (All Roles)
  // ===============================
  if (addUserBtn) {
    addUserBtn.addEventListener("click", () =>
      openPage("User Management", "Manage users and roles", "../Contents/user-management.html")
    );
  }

  if (addProductBtn) {
    addProductBtn.addEventListener("click", () =>
      openPage("Inventory Management", "Track and manage inventory", "../Contents/inventory-management.html")
    );
  }

  if (alertSettingsBtn) {
    alertSettingsBtn.addEventListener("click", () =>
      openPage("Alert Management", "Manage system alerts and notifications", "../Contents/alert.html")
    );
  }
});
</script>

</body>
</html>
