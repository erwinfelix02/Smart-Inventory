<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password</title>
  <link rel="stylesheet" href="forgot-password.css">
  <link rel="icon" type="image/png" href="../images/logo.svg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <!-- Left side image -->
    <div class="image-side"></div>

    <!-- Right side form -->
    <div class="form-side">
      <div class="forgot">
        <h2>Forgot Password?</h2>
        <p class="subtitle">Please enter your email address to reset your password.</p>

        <form id="forgotForm">
          <!-- Email -->
          <div class="input-group">
            <i class="fa-solid fa-envelope"></i>
            <input type="email" id="email" placeholder="Enter your email" required>
                 <p id="emailError" class="error-message"></p>
          </div>

          <button type="submit" class="btn">Verify</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="overlay" id="overlay">
    <div class="spinner"></div>
  </div>

  <script>
const overlay = document.getElementById("overlay");
const emailInput = document.getElementById("email");

// ðŸ§© Create or reuse error message element
let emailError = document.getElementById("emailError");
if (!emailError) {
  emailError = document.createElement("p");
  emailError.id = "emailError";
  emailError.classList.add("error-message");
  emailInput.parentNode.insertAdjacentElement("afterend", emailError);
}

// âœ… Email validation pattern (gmail.com or phinmaed.com)
const emailPattern = /^[a-zA-Z0-9._%+-]+@(gmail\.com|phinmaed\.com)$/;

// ðŸ§¹ Reset input and error state
function resetError() {
  emailInput.classList.remove("input-error");
  emailError.textContent = "";
  emailError.style.display = "none";
}

// ðŸ§¾ Show error helper
function showError(message) {
  emailInput.classList.add("input-error");
  emailError.textContent = message;
  emailError.style.display = "block";
}

// âœ… Show error when leaving input field
emailInput.addEventListener("blur", () => {
  const value = emailInput.value.trim();
  if (value && !emailPattern.test(value)) {
    showError("Please enter a valid email (e.g. example@gmail.com or example@phinmaed.com)");
  }
});

// âœ… Handle form submit
document.getElementById("forgotForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  resetError();

  const email = emailInput.value.trim();

  // Empty field check
  if (!email) {
    showError("Please enter your email address.");
    return;
  }

  // Invalid format check
  if (!emailPattern.test(email)) {
    showError("Please enter a valid email (e.g. example@gmail.com or example@phinmaed.com)");
    return;
  }

  // Show loading overlay
  overlay.style.display = "flex";

  try {
    const res = await fetch("/forgot-password/verify-email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email }),
    });

    const data = await res.json();

    // Slight delay for UX smoothness
    setTimeout(() => {
      overlay.style.display = "none";

      if (!res.ok || !data.success) {
        showError(data.message || "Email not found in our records.");
        return;
      }

      // âœ… Redirect on success
      setTimeout(() => {
        window.location.href =
          "../Landing Page/email.html?email=" +
          encodeURIComponent(email) +
          "&source=forgot";
      }, 1000);
    }, 800);
  } catch (err) {
    console.error(err);
    setTimeout(() => {
      overlay.style.display = "none";
      showError("Server error. Please try again later.");
    }, 800);
  }
});

// ðŸ–Š Remove red border & hide message while typing
emailInput.addEventListener("input", resetError);
</script>


</body>
</html>
